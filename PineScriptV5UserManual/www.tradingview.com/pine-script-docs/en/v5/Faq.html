
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  
<!-- Mirrored from www.tradingview.com/pine-script-docs/en/v5/Faq.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 04 Sep 2023 17:55:56 GMT -->
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>FAQ &#8212; Pine Script® v5 User Manual v5 documentation</title>
    <link rel="stylesheet" href="_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="../../../../static.tradingview.com/static/bundles/pine-highlighter-v01.js"></script>
    <script type="text/javascript" src="_static/highlight-pine-code.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Error messages" href="Error_messages.html" />
    <link rel="prev" title="Limitations" href="writing/Limitations.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Error_messages.html" title="Error messages"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="writing/Limitations.html" title="Limitations"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Pine Script® v5 User Manual v5 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="index.html" class="text-logo">Pine Script<sup>®</sup> v5 User Manual</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Welcome to Pine Script<sup>®</sup> v5</a></li>
<li class="toctree-l1"><a class="reference internal" href="primer/index.html">Pine Script<sup>®</sup> primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="language/index.html">Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts/index.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing/index.html">Writing scripts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#get-real-ohlc-price-on-a-heikin-ashi-chart">Get real OHLC price on a Heikin Ashi chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#get-non-standard-ohlc-values-on-a-standard-chart">Get non-standard OHLC values on a standard chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-arrows-on-the-chart">Plot arrows on the chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-a-dynamic-horizontal-line">Plot a dynamic horizontal line</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-a-vertical-line-on-condition">Plot a vertical line on condition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#access-the-previous-value">Access the previous value</a></li>
<li class="toctree-l2"><a class="reference internal" href="#get-a-5-days-high">Get a 5-days high</a></li>
<li class="toctree-l2"><a class="reference internal" href="#count-bars-in-a-dataset">Count bars in a dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enumerate-bars-in-a-day">Enumerate bars in a day</a></li>
<li class="toctree-l2"><a class="reference internal" href="#find-the-highest-and-lowest-values-for-the-entire-dataset">Find the highest and lowest values for the entire dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#query-the-last-non-na-value">Query the last non-na value</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Error_messages.html">Error messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration_guides/index.html">Migration guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="Where_can_I_get_more_information.html">Where can I get more information?</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="https://www.tradingview.com/pine-script-docs/en/v5/search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="index.html">User Manual</a></li>
              
              <li>FAQ</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <a class="reference external image-reference" href="Introduction.html"><div align="right" class="align-right"><img alt="Pine Script® logo" height="100" src="_images/Pine-script-logo.svg" width="100" /></div>
</a>
<div class="section" id="faq">
<span id="pagefaq"></span><h1>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#get-real-ohlc-price-on-a-heikin-ashi-chart" id="id1">Get real OHLC price on a Heikin Ashi chart</a></li>
<li><a class="reference internal" href="#get-non-standard-ohlc-values-on-a-standard-chart" id="id2">Get non-standard OHLC values on a standard chart</a></li>
<li><a class="reference internal" href="#plot-arrows-on-the-chart" id="id3">Plot arrows on the chart</a></li>
<li><a class="reference internal" href="#plot-a-dynamic-horizontal-line" id="id4">Plot a dynamic horizontal line</a></li>
<li><a class="reference internal" href="#plot-a-vertical-line-on-condition" id="id5">Plot a vertical line on condition</a></li>
<li><a class="reference internal" href="#access-the-previous-value" id="id6">Access the previous value</a></li>
<li><a class="reference internal" href="#get-a-5-days-high" id="id7">Get a 5-days high</a></li>
<li><a class="reference internal" href="#count-bars-in-a-dataset" id="id8">Count bars in a dataset</a></li>
<li><a class="reference internal" href="#enumerate-bars-in-a-day" id="id9">Enumerate bars in a day</a></li>
<li><a class="reference internal" href="#find-the-highest-and-lowest-values-for-the-entire-dataset" id="id10">Find the highest and lowest values for the entire dataset</a></li>
<li><a class="reference internal" href="#query-the-last-non-na-value" id="id11">Query the last non-na value</a></li>
</ul>
</div>
<div class="section" id="get-real-ohlc-price-on-a-heikin-ashi-chart">
<h2><a class="toc-backref" href="#id1">Get real OHLC price on a Heikin Ashi chart</a><a class="headerlink" href="#get-real-ohlc-price-on-a-heikin-ashi-chart" title="Permalink to this headline">¶</a></h2>
<p>Suppose, we have a Heikin Ashi chart (or Renko, Kagi, PriceBreak etc)
and we’ve added a Pine script on it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;Visible OHLC&quot;, overlay=true)
c = close
plot(c)
</pre></div>
</div>
<p>You may see that variable <code class="docutils literal notranslate"><span class="pre">c</span></code> is a Heikin Ashi <em>close</em> price which is not
the same as real OHLC price. Because <code class="docutils literal notranslate"><span class="pre">close</span></code> built-in variable is always
a value that corresponds to a visible bar (or candle) on the chart.</p>
<p>So, how do we get the real OHLC prices in Pine Script<sup>®</sup> code, if current
chart type is non-standard? We should use <code class="docutils literal notranslate"><span class="pre">request.security</span></code> function in
combination with <code class="docutils literal notranslate"><span class="pre">ticker.new</span></code> function. Here is an example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;Real OHLC&quot;, overlay = true)
t = ticker.new(syminfo.prefix, syminfo.ticker)
realC = request.security(t, timeframe.period, close)
plot(realC)
</pre></div>
</div>
<p>In a similar way we may get other OHLC prices: <em>open</em>, <em>high</em> and <em>low</em>.</p>
</div>
<div class="section" id="get-non-standard-ohlc-values-on-a-standard-chart">
<h2><a class="toc-backref" href="#id2">Get non-standard OHLC values on a standard chart</a><a class="headerlink" href="#get-non-standard-ohlc-values-on-a-standard-chart" title="Permalink to this headline">¶</a></h2>
<p>Backtesting on non-standard chart types (e.g. Heikin Ashi or Renko) is not recommended because the bars on these kinds of charts do not represent real price movement that you would encounter while trading. If you want your strategy to enter and exit on real prices but still use Heikin Ashi-based signals, you can use the same method to get Heikin Ashi values on a regular candlestick chart:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
strategy(&quot;BarUpDn Strategy&quot;, overlay = true, default_qty_type = strategy.percent_of_equity, default_qty_value = 10)
maxIdLossPcntInput = input.float(1, &quot;Max Intraday Loss(%)&quot;)
strategy.risk.max_intraday_loss(maxIdLossPcntInput, strategy.percent_of_equity)
needTrade() =&gt; close &gt; open and open &gt; close[1] ? 1 : close &lt; open and open &lt; close[1] ? -1 : 0
trade = request.security(ticker.heikinashi(syminfo.tickerid), timeframe.period, needTrade())
if trade == 1
    strategy.entry(&quot;BarUp&quot;, strategy.long)
if trade == -1
    strategy.entry(&quot;BarDn&quot;, strategy.short)
</pre></div>
</div>
</div>
<div class="section" id="plot-arrows-on-the-chart">
<h2><a class="toc-backref" href="#id3">Plot arrows on the chart</a><a class="headerlink" href="#plot-arrows-on-the-chart" title="Permalink to this headline">¶</a></h2>
<p>You may use plotshape with style <code class="docutils literal notranslate"><span class="pre">shape.arrowup</span></code> and
<code class="docutils literal notranslate"><span class="pre">shape.arrowdown</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&#39;Ex 1&#39;, overlay = true)
condition = close &gt;= open
plotshape(condition, color = color.lime, style = shape.arrowup, text = &quot;Buy&quot;)
plotshape(not condition, color = color.red, style = shape.arrowdown, text = &quot;Sell&quot;)
</pre></div>
</div>
<img alt="_images/Faq-Buy_sell_chart1.png" src="_images/Faq-Buy_sell_chart1.png" />
<p>You may use the <code class="docutils literal notranslate"><span class="pre">plotchar</span></code> function with any unicode character:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&#39;buy/sell arrows&#39;, overlay = true)
condition = close &gt;= open
plotchar(not condition, char=&#39;↓&#39;, color = color.lime, text = &quot;Buy&quot;)
plotchar(condition, char=&#39;↑&#39;, location = location.belowbar, color = color.red, text = &quot;Sell&quot;)
</pre></div>
</div>
<img alt="_images/Faq-Buy_sell_chart2.png" src="_images/Faq-Buy_sell_chart2.png" />
</div>
<div class="section" id="plot-a-dynamic-horizontal-line">
<h2><a class="toc-backref" href="#id4">Plot a dynamic horizontal line</a><a class="headerlink" href="#plot-a-dynamic-horizontal-line" title="Permalink to this headline">¶</a></h2>
<p>There is the function <code class="docutils literal notranslate"><span class="pre">hline</span></code> in Pine Script<sup>®</sup>, but it is limited to only plot a constant value.
Here is a simple script with a workaround to plot a changing hline:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;Horizontal line&quot;, overlay = true)
plot(close[10], trackprice = true, offset = -9999)
// `trackprice = true` plots horizontal line on close[10]
// `offset = -9999` hides the plot
plot(close, color = #FFFFFFFF)  // forces display
</pre></div>
</div>
</div>
<div class="section" id="plot-a-vertical-line-on-condition">
<h2><a class="toc-backref" href="#id5">Plot a vertical line on condition</a><a class="headerlink" href="#plot-a-vertical-line-on-condition" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;Vertical line&quot;, overlay = true, scale = scale.none)
// scale.none means do not resize the chart to fit this plot
// if the bar being evaluated is the last baron the chart (the most recent bar), then cond is true
cond = barstate.islast
// when cond is true, plot a histogram with a line with height value of 100,000,000,000,000,000,000.00
// (10 to the power of 20)
// when cond is false, plot no numeric value (nothing is plotted)
// use the style of histogram, a vertical bar
plot(cond ? 10e20 : na, style = plot.style_histogram)
</pre></div>
</div>
</div>
<div class="section" id="access-the-previous-value">
<h2><a class="toc-backref" href="#id6">Access the previous value</a><a class="headerlink" href="#access-the-previous-value" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
//...
s = 0.0
s := nz(s[1]) // Accessing previous values
if (condition)
    s := s + 1
</pre></div>
</div>
</div>
<div class="section" id="get-a-5-days-high">
<h2><a class="toc-backref" href="#id7">Get a 5-days high</a><a class="headerlink" href="#get-a-5-days-high" title="Permalink to this headline">¶</a></h2>
<p>Lookback 5 days from the current bar, find the highest bar, plot a star
character at that price level above the current bar</p>
<img alt="_images/Faq-Wiki_howto_range_analysis.png" src="_images/Faq-Wiki_howto_range_analysis.png" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;High of last 5 days&quot;, overlay = true)

// Milliseconds in 5 days: millisecs * secs * mins * hours * days
MS_IN_5DAYS = 1000 * 60 * 60 * 24 * 5

// The range check begins 5 days from the current time.
leftBorder = timenow - time &lt; MS_IN_5DAYS
// The range ends on the last bar of the chart.
rightBorder = barstate.islast

// ————— Keep track of highest `high` during the range.
// Intialize `maxHi` with `var` on bar zero only.
// This way, its value is preserved, bar to bar.
var float maxHi = na
if leftBorder
    if not leftBorder[1]
        // Range&#39;s first bar.
        maxHi := high
    else if not rightBorder
        // On other bars in the range, track highest `high`.
        maxHi := math.max(maxHi, high)

// Plot level of the highest `high` on the last bar.
plotchar(rightBorder ? maxHi : na, &quot;Level&quot;, &quot;—&quot;, location.absolute, size = size.normal)
// When in range, color the background.
bgcolor(leftBorder and not rightBorder ? color.new(color.aqua, 70) : na)
</pre></div>
</div>
</div>
<div class="section" id="count-bars-in-a-dataset">
<h2><a class="toc-backref" href="#id8">Count bars in a dataset</a><a class="headerlink" href="#count-bars-in-a-dataset" title="Permalink to this headline">¶</a></h2>
<p>Get a count of all the bars in the loaded dataset. Might be useful for
calculating flexible lookback periods based on number of bars.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;Bar Count&quot;, overlay = true, scale = scale.none)
plot(bar_index + 1, style = plot.style_histogram)
</pre></div>
</div>
</div>
<div class="section" id="enumerate-bars-in-a-day">
<h2><a class="toc-backref" href="#id9">Enumerate bars in a day</a><a class="headerlink" href="#enumerate-bars-in-a-day" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;My Script&quot;, overlay = true, scale = scale.none)

isNewDay() =&gt;
    d = dayofweek
    na(d[1]) or d != d[1]

plot(ta.barssince(isNewDay()), style = plot.style_cross)
</pre></div>
</div>
</div>
<div class="section" id="find-the-highest-and-lowest-values-for-the-entire-dataset">
<h2><a class="toc-backref" href="#id10">Find the highest and lowest values for the entire dataset</a><a class="headerlink" href="#find-the-highest-and-lowest-values-for-the-entire-dataset" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;&quot;, &quot;&quot;, true)

allTimetHi(source) =&gt;
    var atHi = source
    atHi := math.max(atHi, source)

allTimetLo(source) =&gt;
    var atLo = source
    atLo := math.min(atLo, source)

plot(allTimetHi(close), &quot;ATH&quot;, color.green)
plot(allTimetLo(close), &quot;ATL&quot;, color.red)
</pre></div>
</div>
</div>
<div class="section" id="query-the-last-non-na-value">
<h2><a class="toc-backref" href="#id11">Query the last non-na value</a><a class="headerlink" href="#query-the-last-non-na-value" title="Permalink to this headline">¶</a></h2>
<p>You can use the script below to avoid gaps in a series:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;&quot;)
series = close &gt;= open ? close : na
vw = fixnan(series)
plot(series, style = plot.style_linebr, color = color.red)  // series has na values
plot(vw)  // all na values are replaced with the last non-empty value
</pre></div>
</div>
<a class="reference external image-reference" href="https://www.tradingview.com/"><div align="center" class="align-center"><img alt="_images/TradingView-Logo-Block.svg" src="_images/TradingView-Logo-Block.svg" width="200px" /></div>
</a>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="writing/Limitations.html" title="previous chapter (use the left arrow)">Limitations</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="Error_messages.html" title="next chapter (use the right arrow)">Error messages</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Error_messages.html" title="Error messages"
             >next</a> |</li>
        <li class="right" >
          <a href="writing/Limitations.html" title="Limitations"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Pine Script® v5 User Manual v5 documentation</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="_static/js/bootstrap.js"></script>

<script type="text/javascript" src="_static/js/theme.js"></script>


<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Options</span>
    v: v5
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Languages</dt>
      
        <strong>
        <dd><a href="Faq.html">en</a></dd>
        </strong>
      
    </dl>
    <dl>
      <dt>Versions</dt>
      
        
        <dd><a href="https://www.tradingview.com/pine-script-docs/en/v3/Faq.html">v3</a></dd>
        
      
        
        <dd><a href="https://www.tradingview.com/pine-script-docs/en/v4/Faq.html">v4</a></dd>
        
      
        <strong>
        <dd><a href="Faq.html">v5</a></dd>
        </strong>
      
    </dl>
  </div>
</div>
<script type="text/javascript">
    jQuery(function () {
        SphinxRtdTheme.Navigation.enable(false);
    });
</script>
  <div class="footer">
    &copy; Copyright 2023, TradingView.
  </div>
  </body>

<!-- Mirrored from www.tradingview.com/pine-script-docs/en/v5/Faq.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 04 Sep 2023 17:55:57 GMT -->
</html>