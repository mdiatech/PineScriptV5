
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  
<!-- Mirrored from www.tradingview.com/pine-script-docs/en/v5/language/User-defined_functions.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 04 Sep 2023 17:56:03 GMT -->
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>User-defined functions &#8212; Pine Script® v5 User Manual v5 documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../../../static.tradingview.com/static/bundles/pine-highlighter-v01.js"></script>
    <script type="text/javascript" src="../_static/highlight-pine-code.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Objects" href="Objects.html" />
    <link rel="prev" title="Built-ins" href="Built-ins.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Objects.html" title="Objects"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Built-ins.html" title="Built-ins"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Pine Script® v5 User Manual v5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Language</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="../index.html" class="text-logo">Pine Script<sup>®</sup> v5 User Manual</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Welcome to Pine Script<sup>®</sup> v5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../primer/index.html">Pine Script<sup>®</sup> primer</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Language</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Execution_model.html">Execution model</a></li>
<li class="toctree-l2"><a class="reference internal" href="Time_series.html">Time series</a></li>
<li class="toctree-l2"><a class="reference internal" href="Script_structure.html">Script structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="Identifiers.html">Identifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="Operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="Variable_declarations.html">Variable declarations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Conditional_structures.html">Conditional structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="Loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="Type_system.html">Type system</a></li>
<li class="toctree-l2"><a class="reference internal" href="Built-ins.html">Built-ins</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">User-defined functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#single-line-functions">Single-line functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multi-line-functions">Multi-line functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scopes-in-the-script">Scopes in the script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions-that-return-multiple-results">Functions that return multiple results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Objects.html">Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="Methods.html">Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="Arrays.html">Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="Matrices.html">Matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="Maps.html">Maps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing/index.html">Writing scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Error_messages.html">Error messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guides/index.html">Migration guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Where_can_I_get_more_information.html">Where can I get more information?</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="https://www.tradingview.com/pine-script-docs/en/v5/search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">User Manual</a></li>
              
                <li><a href="index.html">Language</a></li>
              
              <li>User-defined functions</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <a class="reference external image-reference" href="../Introduction.html"><div align="right" class="align-right"><img alt="Pine Script® logo" height="100" src="../_images/Pine-script-logo.svg" width="100" /></div>
</a>
<div class="section" id="user-defined-functions">
<span id="pageuserdefinedfunctions"></span><h1>User-defined functions<a class="headerlink" href="#user-defined-functions" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#single-line-functions" id="id2">Single-line functions</a></li>
<li><a class="reference internal" href="#multi-line-functions" id="id3">Multi-line functions</a></li>
<li><a class="reference internal" href="#scopes-in-the-script" id="id4">Scopes in the script</a></li>
<li><a class="reference internal" href="#functions-that-return-multiple-results" id="id5">Functions that return multiple results</a></li>
<li><a class="reference internal" href="#limitations" id="id6">Limitations</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>User-defined functions are functions that you write, as opposed to the built-in functions in Pine Script<sup>®</sup>.
They are useful to define calculations that you must do repetitevely, or that you want to isolate from your script’s main section of calculations.
Think of user-defined functions as a way to extend the capabilities of Pine Script<sup>®</sup>, when no built-in function will do what you need.</p>
<p>You can write your functions in two ways:</p>
<ul class="simple">
<li>In a single line, when they are simple, or</li>
<li>On multiple lines</li>
</ul>
<p>Functions can be located in two places:</p>
<ul class="simple">
<li>If a function is only used in one script, you can include it in the script where it is used.
See our <a class="reference internal" href="../writing/Style_guide.html#pagestyleguide-functiondeclarations"><span class="std std-ref">Style guide</span></a> for recommendations on where to place functions in your script.</li>
<li>You can create a Pine Script<sup>®</sup> <a class="reference internal" href="../concepts/Libraries.html#pagelibraries"><span class="std std-ref">library</span></a> to include your functions, which makes them reusable in other scripts without having to copy their code.
Distinct requirements exist for library functions. They are explained in the page on <a class="reference internal" href="../concepts/Libraries.html#pagelibraries"><span class="std std-ref">libraries</span></a>.</li>
</ul>
<p>Whether they use one line or multiple lines, user-defined functions have the following characteristics:</p>
<ul class="simple">
<li>They cannot be embedded. All functions are defined in the script’s global scope.</li>
<li>They do not support recursion. It is <strong>not allowed</strong> for a function to call itself from within its own code.</li>
<li>The type of the value returned by a function is determined automatically and depends on the type of arguments used in each particular function call.</li>
<li>Each function call</li>
</ul>
</div>
<div class="section" id="single-line-functions">
<h2><a class="toc-backref" href="#id2">Single-line functions</a><a class="headerlink" href="#single-line-functions" title="Permalink to this headline">¶</a></h2>
<p>Simple functions can often be written in one line. This is the formal definition of single-line functions:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;function_declaration&gt;
    &lt;identifier&gt;(&lt;parameter_list&gt;) =&gt; &lt;return_value&gt;

&lt;parameter_list&gt;
    {&lt;parameter_definition&gt;{, &lt;parameter_definition&gt;}}

&lt;parameter_definition&gt;
    [&lt;identifier&gt; = &lt;default_value&gt;]

&lt;return_value&gt;
    &lt;statement&gt; | &lt;expression&gt; | &lt;tuple&gt;
</pre></div>
</div>
<p>Here is an example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>f(x, y) =&gt; x + y
</pre></div>
</div>
<p>After the function <code class="docutils literal notranslate"><span class="pre">f()</span></code> has been declared, it’s possible to call it using different types of arguments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>a = f(open, close)
b = f(2, 2)
c = f(open, 2)
</pre></div>
</div>
<p>In the example above, the type of variable <code class="docutils literal notranslate"><span class="pre">a</span></code> is <em>series</em> because the arguments are both <em>series</em>.
The type of variable <code class="docutils literal notranslate"><span class="pre">b</span></code> is <em>integer</em> because arguments are both <em>literal integers</em>.
The type of variable <code class="docutils literal notranslate"><span class="pre">c</span></code> is <em>series</em> because the addition of a <em>series</em> and <em>literal integer</em> produces a <em>series</em> result.</p>
</div>
<div class="section" id="multi-line-functions">
<h2><a class="toc-backref" href="#id3">Multi-line functions</a><a class="headerlink" href="#multi-line-functions" title="Permalink to this headline">¶</a></h2>
<p>Pine Script<sup>®</sup> also supports multi-line functions with the following syntax:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;identifier&gt;(&lt;parameter_list&gt;) =&gt;
    &lt;local_block&gt;

&lt;identifier&gt;(&lt;list of parameters&gt;) =&gt;
    &lt;variable declaration&gt;
    ...
    &lt;variable declaration or expression&gt;
</pre></div>
</div>
<p>where:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;parameter_list&gt;
    {&lt;parameter_definition&gt;{, &lt;parameter_definition&gt;}}

&lt;parameter_definition&gt;
    [&lt;identifier&gt; = &lt;default_value&gt;]
</pre></div>
</div>
<p>The body of a multi-line function consists of several statements. Each
statement is placed on a separate line and must be preceded by 1
indentation (4 spaces or 1 tab). The indentation before the statement
indicates that it is a part of the body of the function and not part of the
script’s global scope. After the function’s code, the first statement without an indent
indicates the body of the function has ended.</p>
<p>Either an expression or a declared variable should be the last statement
of the function’s body. The result of this expression (or variable) will
be the result of the function’s call. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>geom_average(x, y) =&gt;
    a = x*x
    b = y*y
    math.sqrt(a + b)
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">geom_average</span></code> has two arguments and creates two variables
in the body: <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>. The last statement calls the function <code class="docutils literal notranslate"><span class="pre">math.sqrt</span></code>
(an extraction of the square root). The <code class="docutils literal notranslate"><span class="pre">geom_average</span></code> call will return
the value of the last expression: <code class="docutils literal notranslate"><span class="pre">(math.sqrt(a</span> <span class="pre">+</span> <span class="pre">b))</span></code>.</p>
</div>
<div class="section" id="scopes-in-the-script">
<h2><a class="toc-backref" href="#id4">Scopes in the script</a><a class="headerlink" href="#scopes-in-the-script" title="Permalink to this headline">¶</a></h2>
<p>Variables declared outside the body of a function or of other local blocks belong to
the <em>global</em> scope. User-declared and built-in functions, as well as built-in
variables also belong to the global scope.</p>
<p>Each function has its own <em>local</em> scope. All the variables declared
within the function, as well as the function’s arguments, belong to the scope of
that function, meaning that it is impossible to reference them from
outside — e.g., from the global scope or the local scope of another
function.</p>
<p>On the other hand, since it is possible to refer to any variable or function
declared in the global scope from the scope of a function (except for
self-referencing recursive calls), one can say
that the local scope is embedded into the global scope.</p>
<p>In Pine Script<sup>®</sup>, nested functions are not allowed, i.e., one cannot declare a
function inside another one. All user functions are declared in the
global scope. Local scopes cannot intersect with each other.</p>
</div>
<div class="section" id="functions-that-return-multiple-results">
<h2><a class="toc-backref" href="#id5">Functions that return multiple results</a><a class="headerlink" href="#functions-that-return-multiple-results" title="Permalink to this headline">¶</a></h2>
<p>In most cases a function returns only one result, but it is possible to
return a list of results (a <em>tuple</em>-like result):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fun(x, y) =&gt;
    a = x+y
    b = x-y
    [a, b]
</pre></div>
</div>
<p>Special syntax is required for calling such functions:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[res0, res1] = fun(open, close)
plot(res0)
plot(res1)
</pre></div>
</div>
</div>
<div class="section" id="limitations">
<h2><a class="toc-backref" href="#id6">Limitations</a><a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>User-defined functions can use any of the Pine Script<sup>®</sup> built-ins, except:
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_barcolor">barcolor()</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_fill">fill()</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_hline">hline()</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_indicator">indicator()</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_library">library()</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_plot">plot()</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_plotbar">plotbar()</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_plotcandle">plotcandle()</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_plotchar">plotchar()</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_plotshape">plotshape()</a> and
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_strategy">strategy()</a>.</p>
<a class="reference external image-reference" href="https://www.tradingview.com/"><div align="center" class="align-center"><img alt="../_images/TradingView-Logo-Block.svg" src="../_images/TradingView-Logo-Block.svg" width="200px" /></div>
</a>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="Built-ins.html" title="previous chapter (use the left arrow)">Built-ins</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="Objects.html" title="next chapter (use the right arrow)">Objects</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Objects.html" title="Objects"
             >next</a> |</li>
        <li class="right" >
          <a href="Built-ins.html" title="Built-ins"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Pine Script® v5 User Manual v5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Language</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>

<script type="text/javascript" src="../_static/js/theme.js"></script>


<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Options</span>
    v: v5
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Languages</dt>
      
        <strong>
        <dd><a href="User-defined_functions.html">en</a></dd>
        </strong>
      
    </dl>
    <dl>
      <dt>Versions</dt>
      
        
        <dd><a href="https://www.tradingview.com/pine-script-docs/en/v3/language/User-defined_functions.html">v3</a></dd>
        
      
        
        <dd><a href="https://www.tradingview.com/pine-script-docs/en/v4/language/User-defined_functions.html">v4</a></dd>
        
      
        <strong>
        <dd><a href="User-defined_functions.html">v5</a></dd>
        </strong>
      
    </dl>
  </div>
</div>
<script type="text/javascript">
    jQuery(function () {
        SphinxRtdTheme.Navigation.enable(false);
    });
</script>
  <div class="footer">
    &copy; Copyright 2023, TradingView.
  </div>
  </body>

<!-- Mirrored from www.tradingview.com/pine-script-docs/en/v5/language/User-defined_functions.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 04 Sep 2023 17:56:03 GMT -->
</html>