
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  
<!-- Mirrored from www.tradingview.com/pine-script-docs/en/v5/language/Methods.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 04 Sep 2023 17:56:06 GMT -->
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Methods &#8212; Pine Script® v5 User Manual v5 documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../../../static.tradingview.com/static/bundles/pine-highlighter-v01.js"></script>
    <script type="text/javascript" src="../_static/highlight-pine-code.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Arrays" href="Arrays.html" />
    <link rel="prev" title="Objects" href="Objects.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Arrays.html" title="Arrays"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Objects.html" title="Objects"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Pine Script® v5 User Manual v5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Language</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="../index.html" class="text-logo">Pine Script<sup>®</sup> v5 User Manual</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Welcome to Pine Script<sup>®</sup> v5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../primer/index.html">Pine Script<sup>®</sup> primer</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Language</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Execution_model.html">Execution model</a></li>
<li class="toctree-l2"><a class="reference internal" href="Time_series.html">Time series</a></li>
<li class="toctree-l2"><a class="reference internal" href="Script_structure.html">Script structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="Identifiers.html">Identifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="Operators.html">Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="Variable_declarations.html">Variable declarations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Conditional_structures.html">Conditional structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="Loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="Type_system.html">Type system</a></li>
<li class="toctree-l2"><a class="reference internal" href="Built-ins.html">Built-ins</a></li>
<li class="toctree-l2"><a class="reference internal" href="User-defined_functions.html">User-defined functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Objects.html">Objects</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#built-in-methods">Built-in methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-defined-methods">User-defined methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#method-overloading">Method overloading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-example">Advanced example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Arrays.html">Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="Matrices.html">Matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="Maps.html">Maps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing/index.html">Writing scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Error_messages.html">Error messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Release_notes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guides/index.html">Migration guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Where_can_I_get_more_information.html">Where can I get more information?</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="https://www.tradingview.com/pine-script-docs/en/v5/search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">User Manual</a></li>
              
                <li><a href="index.html">Language</a></li>
              
              <li>Methods</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="figure align-right" style="width: 50%">
<a class="reference external image-reference" href="../Introduction.html"><img alt="../_images/Pine-script-logo.svg" height="100" src="../_images/Pine-script-logo.svg" width="100" /></a>
</div>
<p><a class="reference internal" href="../_images/Advanced.svg"><div align="bottom" class="align-bottom"><img alt="Advanced logo" height="100" src="../_images/Advanced.svg" width="100" /></div>
</a></p>
<div class="section" id="methods">
<span id="pagemethods"></span><h1>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#built-in-methods" id="id2">Built-in methods</a></li>
<li><a class="reference internal" href="#user-defined-methods" id="id3">User-defined methods</a></li>
<li><a class="reference internal" href="#method-overloading" id="id4">Method overloading</a></li>
<li><a class="reference internal" href="#advanced-example" id="id5">Advanced example</a></li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This page contains advanced material. If you are a beginning Pine Script<sup>®</sup> programmer, we recommend
you become familiar with other, more accessible Pine Script<sup>®</sup> features before you venture here.</p>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Pine Script<sup>®</sup> methods are specialized functions associated with specific instances of built-in or user-defined <a class="reference internal" href="Type_system.html#pagetypesystem"><span class="std std-ref">types</span></a>.
They are essentially the same as regular functions in most regards but offer a shorter, more convenient syntax.
Users can access methods using dot notation on variables directly, just like accessing the fields of a Pine Script<sup>®</sup> <a class="reference internal" href="Objects.html#pageobjects"><span class="std std-ref">object</span></a>.</p>
</div>
<div class="section" id="built-in-methods">
<span id="pagemethods-builtinmethods"></span><h2><a class="toc-backref" href="#id2">Built-in methods</a><a class="headerlink" href="#built-in-methods" title="Permalink to this headline">¶</a></h2>
<p>Pine Script<sup>®</sup> includes built-in methods for
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#type_array">array</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#type_matrix">matrix</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#type_map">map</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#type_line">line</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#type_linefill">linefill</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#type_label">label</a>,
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#type_box">box</a>, and
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#type_table">table</a> types.
These methods provide users with a more concise way to call specialized routines for these types within their scripts.</p>
<p>When using these special types, the expressions</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;namespace&gt;.&lt;functionName&gt;([paramName =] &lt;objectName&gt;, …)
</pre></div>
</div>
<p>and</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;objectName&gt;.&lt;functionName&gt;(…)
</pre></div>
</div>
<p>are equivalent. For example, rather than using</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array.get(id, index)
</pre></div>
</div>
<p>to get the value from an array <code class="docutils literal notranslate"><span class="pre">id</span></code> at the specified <code class="docutils literal notranslate"><span class="pre">index</span></code>, we can simply use</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>id.get(index)
</pre></div>
</div>
<p>to achieve the same effect.
This notation eliminates the need for users to reference the function’s namespace, as
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}get">get()</a> is a method of <code class="docutils literal notranslate"><span class="pre">id</span></code> in this context.</p>
<p>Written below is a practical example to demonstrate the usage of built-in methods in place of functions.</p>
<p>The following script computes Bollinger Bands over a specified number of prices sampled once every <code class="docutils literal notranslate"><span class="pre">n</span></code> bars.
It calls <a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}push">array.push()</a> and
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}shift">array.shift()</a> to queue <code class="docutils literal notranslate"><span class="pre">sourceInput</span></code> values through the <code class="docutils literal notranslate"><span class="pre">sourceArray</span></code>,
then <a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}avg">array.avg()</a> and
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}stdev">array.stdev()</a> to compute the <code class="docutils literal notranslate"><span class="pre">sampleMean</span></code> and <code class="docutils literal notranslate"><span class="pre">sampleDev</span></code>.
The script then uses these values to calculate the <code class="docutils literal notranslate"><span class="pre">highBand</span></code> and <code class="docutils literal notranslate"><span class="pre">lowBand</span></code>, which it plots on the chart along with the <code class="docutils literal notranslate"><span class="pre">sampleMean</span></code>:</p>
<img alt="../_images/Methods_custom_bb.png" src="../_images/Methods_custom_bb.png" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;Custom Sample BB&quot;, overlay = true)

float sourceInput  = input.source(close, &quot;Source&quot;)
int   samplesInput = input.int(20, &quot;Samples&quot;)
int   n            = input.int(10, &quot;Bars&quot;)
float multiplier   = input.float(2.0, &quot;StdDev&quot;)

var array&lt;float&gt; sourceArray = array.new&lt;float&gt;(samplesInput)
var float        sampleMean  = na
var float        sampleDev   = na

// Identify if `n` bars have passed.
if bar_index % n == 0
    // Update the queue.
    array.push(sourceArray, sourceInput)
    array.shift(sourceArray)
    // Update the mean and standard deviaiton values.
    sampleMean := array.avg(sourceArray)
    sampleDev  := array.stdev(sourceArray) * multiplier

// Calculate bands.
float highBand = sampleMean + sampleDev
float lowBand  = sampleMean - sampleDev

plot(sampleMean, &quot;Basis&quot;, color.orange)
plot(highBand, &quot;Upper&quot;, color.lime)
plot(lowBand, &quot;Lower&quot;, color.red)
</pre></div>
</div>
<p>Let’s rewrite this code to utilize methods rather than built-in functions.
In this version, we have replaced all built-in <a class="reference external" href="../../../../pine-script-reference/v5/index.html#op_array">array.*</a>
functions in the script with equivalent methods:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;Custom Sample BB&quot;, overlay = true)

float sourceInput  = input.source(close, &quot;Source&quot;)
int   samplesInput = input.int(20, &quot;Samples&quot;)
int   n            = input.int(10, &quot;Bars&quot;)
float multiplier   = input.float(2.0, &quot;StdDev&quot;)

var array&lt;float&gt; sourceArray = array.new&lt;float&gt;(samplesInput)
var float        sampleMean  = na
var float        sampleDev   = na

// Identify if `n` bars have passed.
if bar_index % n == 0
    // Update the queue.
    sourceArray.push(sourceInput)
    sourceArray.shift()
    // Update the mean and standard deviaiton values.
    sampleMean := sourceArray.avg()
    sampleDev  := sourceArray.stdev() * multiplier

// Calculate band values.
float highBand = sampleMean + sampleDev
float lowBand  = sampleMean - sampleDev

plot(sampleMean, &quot;Basis&quot;, color.orange)
plot(highBand, &quot;Upper&quot;, color.lime)
plot(lowBand, &quot;Lower&quot;, color.red)
</pre></div>
</div>
<dl class="docutils">
<dt>Note that:</dt>
<dd><ul class="first last simple">
<li>We call the array methods using <code class="docutils literal notranslate"><span class="pre">sourceArray.*</span></code> rather than referencing the <a class="reference external" href="../../../../pine-script-reference/v5/index.html#op_array">array</a> namespace.</li>
<li>We do not include <code class="docutils literal notranslate"><span class="pre">sourceArray</span></code> as a parameter when we call the methods since they already reference the object.</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="user-defined-methods">
<span id="pagemethods-userdefinedmethods"></span><h2><a class="toc-backref" href="#id3">User-defined methods</a><a class="headerlink" href="#user-defined-methods" title="Permalink to this headline">¶</a></h2>
<p>Pine Script<sup>®</sup> allows users to define custom methods for use with objects of any built-in or user-defined type.
Defining a method is essentially the same as defining a function, but with two key differences:</p>
<ul class="simple">
<li>The <a class="reference external" href="../../../../pine-script-reference/v5/index.html#op_method">method</a> keyword must be included before the function name.</li>
<li>The type of the first parameter in the signature must be explicitly declared, as it represents the type of object that the method will be associated with.</li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[export] method &lt;functionName&gt;(&lt;paramType&gt; &lt;paramName&gt; [= &lt;defaultValue&gt;], …) =&gt;
    &lt;functionBlock&gt;
</pre></div>
</div>
<p>Let’s apply user-defined methods to our previous Bollinger Bands example to encapsulate operations from the global scope,
which will simplify the code and promote reusability.
See this portion from the example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// Identify if `n` bars have passed.
if bar_index % n == 0
    // Update the queue.
    sourceArray.push(sourceInput)
    sourceArray.shift()
    // Update the mean and standard deviaiton values.
    sampleMean := sourceArray.avg()
    sampleDev  := sourceArray.stdev() * multiplier

// Calculate band values.
float highBand = sampleMean + sampleDev
float lowBand  = sampleMean - sampleDev
</pre></div>
</div>
<p>We will start by defining a simple method to queue values through an array in a single call.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">maintainQueue()</span></code> method invokes the <a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}push">push()</a> and
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}shift">shift()</a> methods on a <code class="docutils literal notranslate"><span class="pre">srcArray</span></code> when <code class="docutils literal notranslate"><span class="pre">takeSample</span></code> is true and returns
the object:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// @function         Maintains a queue of the size of `srcArray`.
//                   It appends a `value` to the array and removes its oldest element at position zero.
// @param srcArray   (array&lt;float&gt;) The array where the queue is maintained.
// @param value      (float) The new value to be added to the queue.
//                   The queue&#39;s oldest value is also removed, so its size is constant.
// @param takeSample (bool) A new `value` is only pushed into the queue if this is true.
// @returns          (array&lt;float&gt;) `srcArray` object.
method maintainQueue(array&lt;float&gt; srcArray, float value, bool takeSample = true) =&gt;
    if takeSample
        srcArray.push(value)
        srcArray.shift()
    srcArray
</pre></div>
</div>
<dl class="docutils">
<dt>Note that:</dt>
<dd><ul class="first last simple">
<li>Just as with user-defined functions, we use the <code class="docutils literal notranslate"><span class="pre">&#64;function</span></code> <a class="reference internal" href="Script_structure.html#pagescriptstructure-compilerannotations"><span class="std std-ref">compiler annotation</span></a> to document method descriptions.</li>
</ul>
</dd>
</dl>
<p>Now we can replace <code class="docutils literal notranslate"><span class="pre">sourceArray.push()</span></code> and <code class="docutils literal notranslate"><span class="pre">sourceArray.shift()</span></code> with <code class="docutils literal notranslate"><span class="pre">sourceArray.maintainQueue()</span></code> in our example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// Identify if `n` bars have passed.
if bar_index % n == 0
    // Update the queue.
    sourceArray.maintainQueue(sourceInput)
    // Update the mean and standard deviaiton values.
    sampleMean  := sourceArray.avg()
    sampleDev   := sourceArray.stdev() * multiplier

// Calculate band values.
float highBand  = sampleMean + sampleDev
float lowBand   = sampleMean - sampleDev
</pre></div>
</div>
<p>From here, we will further simplify our code by defining a method that handles all Bollinger Band calculations within its scope.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">calcBB()</span></code> method invokes the <a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}avg">avg()</a> and
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}stdev">stdev()</a> methods on a <code class="docutils literal notranslate"><span class="pre">srcArray</span></code> to update <code class="docutils literal notranslate"><span class="pre">mean</span></code> and <code class="docutils literal notranslate"><span class="pre">dev</span></code> values
when <code class="docutils literal notranslate"><span class="pre">calculate</span></code> is true.
The method uses these values to return a tuple containing the basis, upper band, and lower band values respectively:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// @function         Computes Bollinger Band values from an array of data.
// @param srcArray   (array&lt;float&gt;) The array where the queue is maintained.
// @param multiplier (float) Standard deviaiton multiplier.
// @param calcuate   (bool) The method will only calculate new values when this is true.
// @returns          A tuple containing the basis, upper band, and lower band respectively.
method calcBB(array&lt;float&gt; srcArray, float mult, bool calculate = true) =&gt;
    var float mean = na
    var float dev  = na
    if calculate
        // Compute the mean and standard deviation of the array.
        mean := srcArray.avg()
        dev  := srcArray.stdev() * mult
    [mean, mean + dev, mean - dev]
</pre></div>
</div>
<p>With this method, we can now remove Bollinger Band calculations from the global scope and improve code readability:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// Identify if `n` bars have passed.
bool newSample = bar_index % n == 0

// Update the queue and compute new BB values on each new sample.
[sampleMean, highBand, lowBand] = sourceArray.maintainQueue(sourceInput, newSample).calcBB(multiplier, newSample)
</pre></div>
</div>
<dl class="docutils">
<dt>Note that:</dt>
<dd><ul class="first last simple">
<li>Rather than using an <code class="docutils literal notranslate"><span class="pre">if</span></code> block in the global scope, we have defined a <code class="docutils literal notranslate"><span class="pre">newSample</span></code> variable that is only true once every <code class="docutils literal notranslate"><span class="pre">n</span></code> bars. The <code class="docutils literal notranslate"><span class="pre">maintainQueue()</span></code> and <code class="docutils literal notranslate"><span class="pre">calcBB()</span></code> methods use this value for their respective <code class="docutils literal notranslate"><span class="pre">takeSample</span></code> and <code class="docutils literal notranslate"><span class="pre">calculate</span></code> parameters.</li>
<li>Since the <code class="docutils literal notranslate"><span class="pre">maintainQueue()</span></code> method returns the object that it references, we’re able to call <code class="docutils literal notranslate"><span class="pre">calcBB()</span></code> from the same line of code, as both methods apply to <code class="docutils literal notranslate"><span class="pre">array&lt;float&gt;</span></code> instances.</li>
</ul>
</dd>
</dl>
<p>Here is how the full script example looks now that we’ve applied our user-defined methods:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;Custom Sample BB&quot;, overlay = true)

float sourceInput  = input.source(close, &quot;Source&quot;)
int   samplesInput = input.int(20, &quot;Samples&quot;)
int   n            = input.int(10, &quot;Bars&quot;)
float multiplier   = input.float(2.0, &quot;StdDev&quot;)

var array&lt;float&gt; sourceArray = array.new&lt;float&gt;(samplesInput)

// @function         Maintains a queue of the size of `srcArray`.
//                   It appends a `value` to the array and removes its oldest element at position zero.
// @param srcArray   (array&lt;float&gt;) The array where the queue is maintained.
// @param value      (float) The new value to be added to the queue.
//                   The queue&#39;s oldest value is also removed, so its size is constant.
// @param takeSample (bool) A new `value` is only pushed into the queue if this is true.
// @returns          (array&lt;float&gt;) `srcArray` object.
method maintainQueue(array&lt;float&gt; srcArray, float value, bool takeSample = true) =&gt;
    if takeSample
        srcArray.push(value)
        srcArray.shift()
    srcArray

// @function         Computes Bollinger Band values from an array of data.
// @param srcArray   (array&lt;float&gt;) The array where the queue is maintained.
// @param multiplier (float) Standard deviaiton multiplier.
// @param calcuate   (bool) The method will only calculate new values when this is true.
// @returns          A tuple containing the basis, upper band, and lower band respectively.
method calcBB(array&lt;float&gt; srcArray, float mult, bool calculate = true) =&gt;
    var float mean = na
    var float dev  = na
    if calculate
        // Compute the mean and standard deviation of the array.
        mean := srcArray.avg()
        dev  := srcArray.stdev() * mult
    [mean, mean + dev, mean - dev]

// Identify if `n` bars have passed.
bool newSample = bar_index % n == 0

// Update the queue and compute new BB values on each new sample.
[sampleMean, highBand, lowBand] = sourceArray.maintainQueue(sourceInput, newSample).calcBB(multiplier, newSample)

plot(sampleMean, &quot;Basis&quot;, color.orange)
plot(highBand, &quot;Upper&quot;, color.lime)
plot(lowBand, &quot;Lower&quot;, color.red)
</pre></div>
</div>
</div>
<div class="section" id="method-overloading">
<span id="pagemethods-methodoverloading"></span><h2><a class="toc-backref" href="#id4">Method overloading</a><a class="headerlink" href="#method-overloading" title="Permalink to this headline">¶</a></h2>
<p>User-defined methods can override and overload existing built-in and user-defined methods with the same identifier.
This capability allows users to define multiple routines associated with different parameter signatures under the same method name.</p>
<p>As a simple example, suppose we want to define a method to identify a variable’s type.
Since we must explicitly specify the type of object associated with a user-defined method,
we will need to define overloads for each type that we want it to recognize.</p>
<p>Below, we have defined a <code class="docutils literal notranslate"><span class="pre">getType()</span></code> method that returns a string representation of a variable’s type with overloads for the five primitive types:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// @function   Identifies an object&#39;s type.
// @param this Object to inspect.
// @returns    (string) A string representation of the type.
method getType(int this) =&gt;
    na(this) ? &quot;int(na)&quot; : &quot;int&quot;

method getType(float this) =&gt;
    na(this) ? &quot;float(na)&quot; : &quot;float&quot;

method getType(bool this) =&gt;
    na(this) ? &quot;bool(na)&quot; : &quot;bool&quot;

method getType(color this) =&gt;
    na(this) ? &quot;color(na)&quot; : &quot;color&quot;

method getType(string this) =&gt;
    na(this) ? &quot;string(na)&quot; : &quot;string&quot;
</pre></div>
</div>
<p>Now we can use these overloads to inspect some variables.
This script uses <a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_str{dot}format">str.format()</a>
to format the results from calling the <code class="docutils literal notranslate"><span class="pre">getType()</span></code> method on five different variables into a single <code class="docutils literal notranslate"><span class="pre">results</span></code> string,
then displays the string in the <code class="docutils literal notranslate"><span class="pre">lbl</span></code> label using the built-in
<a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_label{dot}set_text">set_text()</a> method:</p>
<img alt="../_images/Methods_overloads_type_inspection.png" src="../_images/Methods_overloads_type_inspection.png" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;Type Inspection&quot;)

// @function   Identifies an object&#39;s type.
// @param this Object to inspect.
// @returns    (string) A string representation of the type.
method getType(int this) =&gt;
    na(this) ? &quot;int(na)&quot; : &quot;int&quot;

method getType(float this) =&gt;
    na(this) ? &quot;float(na)&quot; : &quot;float&quot;

method getType(bool this) =&gt;
    na(this) ? &quot;bool(na)&quot; : &quot;bool&quot;

method getType(color this) =&gt;
    na(this) ? &quot;color(na)&quot; : &quot;color&quot;

method getType(string this) =&gt;
    na(this) ? &quot;string(na)&quot; : &quot;string&quot;

a = 1
b = 1.0
c = true
d = color.white
e = &quot;1&quot;

// Inspect variables and format results.
results = str.format(
 &quot;a: {0}\nb: {1}\nc: {2}\nd: {3}\ne: {4}&quot;,
 a.getType(), b.getType(), c.getType(), d.getType(), e.getType()
 )

var label lbl = label.new(0, 0)
lbl.set_x(bar_index)
lbl.set_text(results)
</pre></div>
</div>
<dl class="docutils">
<dt>Note that:</dt>
<dd><ul class="first last simple">
<li>The underlying type of each variable determines which overload of <code class="docutils literal notranslate"><span class="pre">getType()</span></code> the compiler will use.</li>
<li>The method will append “(na)” to the output string when a variable is <code class="docutils literal notranslate"><span class="pre">na</span></code> to demarcate that it is empty.</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="advanced-example">
<span id="pagemethods-advancedexample"></span><h2><a class="toc-backref" href="#id5">Advanced example</a><a class="headerlink" href="#advanced-example" title="Permalink to this headline">¶</a></h2>
<p>Let’s apply what we’ve learned to construct a script that estimates the cumulative distribution of elements in an array,
meaning the fraction of elements in the array that are less than or equal to any given value.</p>
<p>There are many ways in which we could choose to tackle this objective.
For this example, we will start by defining a method to replace elements of an array,
which will help us count the occurrences of elements within a range of values.</p>
<p>Written below is an overload of the built-in <a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}fill">fill()</a>
method for <code class="docutils literal notranslate"><span class="pre">array&lt;float&gt;</span></code> instances. This overload replaces elements in a <code class="docutils literal notranslate"><span class="pre">srcArray</span></code> within the range between the
<code class="docutils literal notranslate"><span class="pre">lowerBound</span></code> and <code class="docutils literal notranslate"><span class="pre">upperBound</span></code> with an <code class="docutils literal notranslate"><span class="pre">innerValue</span></code>, and replaces all elements outside the range with an <code class="docutils literal notranslate"><span class="pre">outerValue</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// @function          Replaces elements in a `srcArray` between `lowerBound` and `upperBound` with an `innerValue`,
//                    and replaces elements outside the range with an `outerValue`.
// @param srcArray    (array&lt;float&gt;) Array to modify.
// @param innerValue  (float) Value to replace elements within the range with.
// @param outerValue  (float) Value to replace elements outside the range with.
// @param lowerBound  (float) Lowest value to replace with `innerValue`.
// @param upperBound  (float) Highest value to replace with `innerValue`.
// @returns           (array&lt;float&gt;) `srcArray` object.
method fill(array&lt;float&gt; srcArray, float innerValue, float outerValue, float lowerBound, float upperBound) =&gt;
    for [i, element] in srcArray
        if (element &gt;= lowerBound or na(lowerBound)) and (element &lt;= upperBound or na(upperBound))
            srcArray.set(i, innerValue)
        else
            srcArray.set(i, outerValue)
    srcArray
</pre></div>
</div>
<p>With this method, we can filter an array by value ranges to produce an array of occurrences. For example, the expression</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>srcArray.copy().fill(1.0, 0.0, min, val)
</pre></div>
</div>
<p>copies the <code class="docutils literal notranslate"><span class="pre">srcArray</span></code> object, replaces all elements between <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">val</span></code> with 1.0, then replaces all elements above <code class="docutils literal notranslate"><span class="pre">val</span></code> with 0.0.
From here, it’s easy to estimate the output of the cumulative distribution function at the <code class="docutils literal notranslate"><span class="pre">val</span></code>, as it’s simply the average of the resulting array:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>srcArray.copy().fill(1.0, 0.0, min, val).avg()
</pre></div>
</div>
<dl class="docutils">
<dt>Note that:</dt>
<dd><ul class="first last simple">
<li>The compiler will only use this <code class="docutils literal notranslate"><span class="pre">fill()</span></code> overload instead of the built-in when the user provides <code class="docutils literal notranslate"><span class="pre">innerValue</span></code>, <code class="docutils literal notranslate"><span class="pre">outerValue</span></code>, <code class="docutils literal notranslate"><span class="pre">lowerBound</span></code>, and <code class="docutils literal notranslate"><span class="pre">upperBound</span></code> arguments in the call.</li>
<li>If either <code class="docutils literal notranslate"><span class="pre">lowerBound</span></code> or <code class="docutils literal notranslate"><span class="pre">upperBound</span></code> is <code class="docutils literal notranslate"><span class="pre">na</span></code>, its value is ignored while filtering the fill range.</li>
<li>We are able to call <code class="docutils literal notranslate"><span class="pre">copy()</span></code>, <code class="docutils literal notranslate"><span class="pre">fill()</span></code>, and <code class="docutils literal notranslate"><span class="pre">avg()</span></code> successively on the same line of code because the first two methods return an <code class="docutils literal notranslate"><span class="pre">array&lt;float&gt;</span></code> instance.</li>
</ul>
</dd>
</dl>
<p>We can now use this to define a method that will calculate our empirical distribution values.
The following <code class="docutils literal notranslate"><span class="pre">eCDF()</span></code> method estimates a number of evenly spaced ascending <code class="docutils literal notranslate"><span class="pre">steps</span></code> from
the cumulative distribution function of a <code class="docutils literal notranslate"><span class="pre">srcArray</span></code> and pushes the results into a <code class="docutils literal notranslate"><span class="pre">cdfArray</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// @function       Estimates the empirical CDF of a `srcArray`.
// @param srcArray (array&lt;float&gt;) Array to calculate on.
// @param steps    (int) Number of steps in the estimation.
// @returns        (array&lt;float&gt;) Array of estimated CDF ratios.
method eCDF(array&lt;float&gt; srcArray, int steps) =&gt;
    float min = srcArray.min()
    float rng = srcArray.range() / steps
    array&lt;float&gt; cdfArray = array.new&lt;float&gt;()
    // Add averages of `srcArray` filtered by value region to the `cdfArray`.
    float val = min
    for i = 1 to steps
        val += rng
        cdfArray.push(srcArray.copy().fill(1.0, 0.0, min, val).avg())
    cdfArray
</pre></div>
</div>
<p>Lastly, to ensure that our <code class="docutils literal notranslate"><span class="pre">eCDF()</span></code> method functions properly for arrays containing small and large values,
we will define a method to normalize our arrays.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">featureScale()</span></code> method uses array <a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}min">min()</a>
and <a class="reference external" href="../../../../pine-script-reference/v5/index.html#fun_array{dot}range">range()</a> methods to produce a rescaled copy of a <code class="docutils literal notranslate"><span class="pre">srcArray</span></code>.
We will use this to normalize our arrays prior to invoking the <code class="docutils literal notranslate"><span class="pre">eCDF()</span></code> method:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// @function        Rescales the elements within a `srcArray` to the interval [0, 1].
// @param srcArray  (array&lt;float&gt;) Array to normalize.
// @returns         (array&lt;float&gt;) Normalized copy of the `srcArray`.
method featureScale(array&lt;float&gt; srcArray) =&gt;
    float min = srcArray.min()
    float rng = srcArray.range()
    array&lt;float&gt; scaledArray = array.new&lt;float&gt;()
    // Push normalized `element` values into the `scaledArray`.
    for element in srcArray
        scaledArray.push((element - min) / rng)
    scaledArray
</pre></div>
</div>
<dl class="docutils">
<dt>Note that:</dt>
<dd><ul class="first last simple">
<li>This method does not include special handling for divide by zero conditions. If <code class="docutils literal notranslate"><span class="pre">rng</span></code> is 0, the value of the array element will be <code class="docutils literal notranslate"><span class="pre">na</span></code>.</li>
</ul>
</dd>
</dl>
<p>The full example below queues a <code class="docutils literal notranslate"><span class="pre">sourceArray</span></code> of size <code class="docutils literal notranslate"><span class="pre">length</span></code> with <code class="docutils literal notranslate"><span class="pre">sourceInput</span></code> values using our previous <code class="docutils literal notranslate"><span class="pre">maintainQueue()</span></code> method,
normalizes the array’s elements using the <code class="docutils literal notranslate"><span class="pre">featureScale()</span></code> method, then calls the <code class="docutils literal notranslate"><span class="pre">eCDF()</span></code> method to get an array of estimates for
<code class="docutils literal notranslate"><span class="pre">n</span></code> evenly spaced steps on the distribution. The script then calls a user-defined <code class="docutils literal notranslate"><span class="pre">makeLabel()</span></code> function to display the estimates and prices
in a label on the right side of the chart:</p>
<img alt="../_images/Methods_empirical_distribution.png" src="../_images/Methods_empirical_distribution.png" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//@version=5
indicator(&quot;Empirical Distribution&quot;, overlay = true)

float sourceInput = input.source(close, &quot;Source&quot;)
int length        = input.int(20, &quot;Length&quot;)
int n             = input.int(20, &quot;Steps&quot;)

// @function         Maintains a queue of the size of `srcArray`.
//                   It appends a `value` to the array and removes its oldest element at position zero.
// @param srcArray   (array&lt;float&gt;) The array where the queue is maintained.
// @param value      (float) The new value to be added to the queue.
//                   The queue&#39;s oldest value is also removed, so its size is constant.
// @param takeSample (bool) A new `value` is only pushed into the queue if this is true.
// @returns          (array&lt;float&gt;) `srcArray` object.
method maintainQueue(array&lt;float&gt; srcArray, float value, bool takeSample = true) =&gt;
    if takeSample
        srcArray.push(value)
        srcArray.shift()
    srcArray

// @function          Replaces elements in a `srcArray` between `lowerBound` and `upperBound` with an `innerValue`,
//                    and replaces elements outside the range with an `outerValue`.
// @param srcArray    (array&lt;float&gt;) Array to modify.
// @param innerValue  (float) Value to replace elements within the range with.
// @param outerValue  (float) Value to replace elements outside the range with.
// @param lowerBound  (float) Lowest value to replace with `innerValue`.
// @param upperBound  (float) Highest value to replace with `innerValue`.
// @returns           (array&lt;float&gt;) `srcArray` object.
method fill(array&lt;float&gt; srcArray, float innerValue, float outerValue, float lowerBound, float upperBound) =&gt;
    for [i, element] in srcArray
        if (element &gt;= lowerBound or na(lowerBound)) and (element &lt;= upperBound or na(upperBound))
            srcArray.set(i, innerValue)
        else
            srcArray.set(i, outerValue)
    srcArray

// @function       Estimates the empirical CDF of a `srcArray`.
// @param srcArray (array&lt;float&gt;) Array to calculate on.
// @param steps    (int) Number of steps in the estimation.
// @returns        (array&lt;float&gt;) Array of estimated CDF ratios.
method eCDF(array&lt;float&gt; srcArray, int steps) =&gt;
    float min = srcArray.min()
    float rng = srcArray.range() / steps
    array&lt;float&gt; cdfArray = array.new&lt;float&gt;()
    // Add averages of `srcArray` filtered by value region to the `cdfArray`.
    float val = min
    for i = 1 to steps
        val += rng
        cdfArray.push(srcArray.copy().fill(1.0, 0.0, min, val).avg())
    cdfArray

// @function        Rescales the elements within a `srcArray` to the interval [0, 1].
// @param srcArray  (array&lt;float&gt;) Array to normalize.
// @returns         (array&lt;float&gt;) Normalized copy of the `srcArray`.
method featureScale(array&lt;float&gt; srcArray) =&gt;
    float min = srcArray.min()
    float rng = srcArray.range()
    array&lt;float&gt; scaledArray = array.new&lt;float&gt;()
    // Push normalized `element` values into the `scaledArray`.
    for element in srcArray
        scaledArray.push((element - min) / rng)
    scaledArray

// @function        Draws a label containing eCDF estimates in the format &quot;{price}: {percent}%&quot;
// @param srcArray  (array&lt;float&gt;) Array of source values.
// @param cdfArray  (array&lt;float&gt;) Array of CDF estimates.
// @returns         (void)
makeLabel(array&lt;float&gt; srcArray, array&lt;float&gt; cdfArray) =&gt;
    float max      = srcArray.max()
    float rng      = srcArray.range() / cdfArray.size()
    string results = &quot;&quot;
    var label lbl  = label.new(0, 0, &quot;&quot;, style = label.style_label_left, text_font_family = font.family_monospace)
    // Add percentage strings to `results` starting from the `max`.
    cdfArray.reverse()
    for [i, element] in cdfArray
        results += str.format(&quot;{0}: {1}%\n&quot;, max - i * rng, element * 100)
    // Update `lbl` attributes.
    lbl.set_xy(bar_index + 1, srcArray.avg())
    lbl.set_text(results)

var array&lt;float&gt; sourceArray = array.new&lt;float&gt;(length)

// Add background color for the last `length` bars.
bgcolor(bar_index &gt; last_bar_index - length ? color.new(color.orange, 80) : na)

// Queue `sourceArray`, feature scale, then estimate the distribution over `n` steps.
array&lt;float&gt; distArray = sourceArray.maintainQueue(sourceInput).featureScale().eCDF(n)
// Draw label.
makeLabel(sourceArray, distArray)
</pre></div>
</div>
<a class="reference external image-reference" href="https://www.tradingview.com/"><div align="center" class="align-center"><img alt="../_images/TradingView-Logo-Block.svg" src="../_images/TradingView-Logo-Block.svg" width="200px" /></div>
</a>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="Objects.html" title="previous chapter (use the left arrow)">Objects</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="Arrays.html" title="next chapter (use the right arrow)">Arrays</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Arrays.html" title="Arrays"
             >next</a> |</li>
        <li class="right" >
          <a href="Objects.html" title="Objects"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Pine Script® v5 User Manual v5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Language</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>

<script type="text/javascript" src="../_static/js/theme.js"></script>


<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Options</span>
    v: v5
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Languages</dt>
      
        <strong>
        <dd><a href="Methods.html">en</a></dd>
        </strong>
      
    </dl>
    <dl>
      <dt>Versions</dt>
      
        
        <dd><a href="https://www.tradingview.com/pine-script-docs/en/v3/language/Methods.html">v3</a></dd>
        
      
        
        <dd><a href="https://www.tradingview.com/pine-script-docs/en/v4/language/Methods.html">v4</a></dd>
        
      
        <strong>
        <dd><a href="Methods.html">v5</a></dd>
        </strong>
      
    </dl>
  </div>
</div>
<script type="text/javascript">
    jQuery(function () {
        SphinxRtdTheme.Navigation.enable(false);
    });
</script>
  <div class="footer">
    &copy; Copyright 2023, TradingView.
  </div>
  </body>

<!-- Mirrored from www.tradingview.com/pine-script-docs/en/v5/language/Methods.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 04 Sep 2023 17:56:07 GMT -->
</html>